<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Consulta de Refei√ß√µes</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root {
  --blue: #1a73e8;
  --purple: #9334e6;
  --green: #188038;
  --bg: #f1f3f4;
}

body {
  background: var(--bg);
  padding: 12px;
}

/* üîù TOPO */
.top-actions {
  display: flex;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 16px;
}

@media (max-width: 576px) {
  .top-actions {
    flex-direction: column;
  }
  .left-actions {
    display: flex;
    gap: 8px;
  }
  .left-actions a,
  .logout-btn {
    flex: 1;
  }
}

/* HEADER */
.header-title {
  background: var(--blue);
  color: white;
  text-align: center;
  padding: 14px;
  border-radius: 14px;
  font-weight: bold;
  margin-bottom: 16px;
  font-size: 1.3rem;
}

/* CALEND√ÅRIO */
.calendario-titulo {
  text-align: center;
  font-size: 1.2rem;
  font-weight: 700;
  margin-bottom: 10px;
}

.calendario {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 6px;
}

.dia {
  background: white;
  border-radius: 10px;
  min-height: 90px;
  padding: 6px;
  position: relative;
}

.dia-num {
  position: absolute;
  top: 6px;
  right: 8px;
  font-size: 12px;
  font-weight: bold;
}

.evento {
  margin-top: 22px;
  padding: 4px 6px;
  border-radius: 6px;
  font-size: 11px;
  color: white;
  cursor: pointer;
}

.almoco { background: var(--blue); }
.janta { background: var(--purple); }
.ambos { background: var(--green); }

@media (max-width: 576px) {
  .dia { min-height: 75px; }
}
</style>
</head>

<body>

<div class="container">

  <!-- üîù TOPO -->
  <div class="top-actions">
    <div class="left-actions">
      <a href="https://coec-epb.github.io/prestacao_de_contas/" class="btn btn-primary">‚¨ÖÔ∏è Voltar</a>
      <a href="https://coec-epb.github.io/administrador/" class="btn btn-dark">üîê Administra√ß√£o</a>
    </div>
    <button class="btn btn-danger logout-btn" onclick="logout()">üö™ Sair</button>
  </div>

  <div class="header-title">üìÖ Consulta de Refei√ß√µes</div>

  <!-- FILTROS -->
  <div class="card p-3 mb-3">
    <div class="row g-2">
      <div class="col-12 col-md-4">
        <label>Matr√≠cula</label>
        <input id="matricula" class="form-control" readonly>
      </div>
      <div class="col-6 col-md-3">
        <label>M√™s</label>
        <select id="mes" class="form-select">
          <option value="">Selecione</option>
          <option value="01">Janeiro</option>
          <option value="02">Fevereiro</option>
          <option value="03">Mar√ßo</option>
          <option value="04">Abril</option>
          <option value="05">Maio</option>
          <option value="06">Junho</option>
          <option value="07">Julho</option>
          <option value="08">Agosto</option>
          <option value="09">Setembro</option>
          <option value="10">Outubro</option>
          <option value="11">Novembro</option>
          <option value="12">Dezembro</option>
        </select>
      </div>
      <div class="col-6 col-md-3">
        <label>Ano</label>
        <select id="ano" class="form-select"></select>
      </div>
      <div class="col-12 col-md-2 d-flex align-items-end">
        <button class="btn btn-primary w-100" onclick="buscar()">Buscar</button>
      </div>
    </div>
  </div>

  <!-- CALEND√ÅRIO -->
  <div class="card p-3">
    <div id="tituloMes" class="calendario-titulo"></div>
    <div id="calendario" class="calendario"></div>
  </div>

</div>

<!-- MODAL -->
<div class="modal fade" id="modalDia">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Detalhes do Dia</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="modalConteudo"></div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
const matricula = localStorage.getItem("matricula");
if (!matricula) location.href = "https://coec-epb.github.io/login/";
document.getElementById("matricula").value = matricula;

const mesesNome = ["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];

const anoAtual = new Date().getFullYear();
const anoSelect = document.getElementById("ano");
for (let a = anoAtual; a >= anoAtual - 5; a--) {
  anoSelect.innerHTML += `<option value="${a}">${a}</option>`;
}

let dadosMes = [];

async function buscar() {
  const mes = document.getElementById("mes").value;
  const ano = document.getElementById("ano").value;
  if (!mes || !ano) return alert("Selecione m√™s e ano");

  document.getElementById("tituloMes").innerText = `${mesesNome[mes-1]} / ${ano}`;

  const resp = await fetch(`https://long-hall-0aaa.pedro-fillype.workers.dev/buscar?matricula=${matricula}&mes=${mes}&ano=${ano}`);
  dadosMes = await resp.json();
  montarCalendario();
}
</script>

</body>
</html>
