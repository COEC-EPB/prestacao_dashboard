<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta de RefeiÃ§Ãµes</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root {
  --energisa-blue: #0097CE;
  --energisa-blue-dark: #0079a6;
  --energisa-orange: #F36F21;
  --bg-soft: #f5f7fa;
}

body {
  background: var(--bg-soft);
  padding: 25px;
  font-family: Arial, sans-serif;
}

.card {
  border-radius: 14px;
  border: none;
  box-shadow: 0 4px 14px rgba(0,0,0,0.08);
}

.header-title {
  background: var(--energisa-blue);
  padding: 15px 20px;
  color: white;
  border-radius: 12px;
  text-align: center;
  font-size: 1.6rem;
  font-weight: bold;
  margin-bottom: 25px;
}

.btn-energisa {
  background: var(--energisa-blue);
  color: white;
  border-radius: 8px;
}
.btn-energisa:hover { background: var(--energisa-blue-dark); }

.logout-btn {
  background: #dc3545;
  color: white;
  border-radius: 8px;
}

/* ğŸ“… CALENDÃRIO */
.calendario {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 10px;
}

.dia {
  padding: 10px;
  border-radius: 10px;
  background: #f1f3f5;
  text-align: center;
  font-weight: 600;
  min-height: 70px;
}

.dia.vazio {
  background: transparent;
}

.dia.registrado {
  background: var(--energisa-blue);
  color: white;
}

.dia .sequencia {
  display: block;
  font-size: 12px;
  margin-top: 6px;
  font-weight: normal;
}
</style>
</head>
<body>

<div class="container">

  <!-- TOPO -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <a href="https://coec-epb.github.io/prestacao_de_contas/" class="btn btn-energisa">â¬…ï¸ Voltar</a>
    <button class="btn logout-btn" onclick="logout()">ğŸšª Sair</button>
  </div>

  <div class="header-title">ğŸ“Š Consulta de RefeiÃ§Ãµes</div>

  <!-- FILTROS -->
  <div class="card p-3 mb-4">
    <h5 class="mb-3">Filtros</h5>
    <div class="row g-3">
      <div class="col-md-4">
        <label>MatrÃ­cula</label>
        <input id="matricula" class="form-control" readonly>
      </div>
      <div class="col-md-3">
        <label>MÃªs</label>
        <select id="mes" class="form-select">
          <option value="">Selecione</option>
          <option value="01">Janeiro</option>
          <option value="02">Fevereiro</option>
          <option value="03">MarÃ§o</option>
          <option value="04">Abril</option>
          <option value="05">Maio</option>
          <option value="06">Junho</option>
          <option value="07">Julho</option>
          <option value="08">Agosto</option>
          <option value="09">Setembro</option>
          <option value="10">Outubro</option>
          <option value="11">Novembro</option>
          <option value="12">Dezembro</option>
        </select>
      </div>
      <div class="col-md-3">
        <label>Ano</label>
        <select id="ano" class="form-select"></select>
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <button class="btn btn-energisa w-100" onclick="buscar()">Buscar</button>
      </div>
    </div>
  </div>

  <!-- CALENDÃRIO -->
  <div class="card p-4">
    <h5 class="mb-3">ğŸ“… CalendÃ¡rio do MÃªs</h5>
    <div id="calendario" class="calendario"></div>
  </div>

</div>

<script>
/* LOGIN */
const matriculaLogin = localStorage.getItem("matricula");
if (!matriculaLogin) window.location.href = "https://coec-epb.github.io/login/";

document.getElementById("matricula").value = matriculaLogin;

/* ANOS */
const anoAtual = new Date().getFullYear();
const anoSelect = document.getElementById("ano");
for (let a = anoAtual; a >= anoAtual - 5; a--) {
  anoSelect.innerHTML += `<option value="${a}">${a}</option>`;
}

/* LOGOUT */
function logout() {
  localStorage.clear();
  window.location.href = "https://coec-epb.github.io/login/";
}

/* BUSCAR */
async function buscar() {
  const mes = document.getElementById("mes").value;
  const ano = document.getElementById("ano").value;

  if (!mes || !ano) {
    alert("Selecione mÃªs e ano.");
    return;
  }

  const url = `https://long-hall-0aaa.pedro-fillype.workers.dev/buscar?matricula=${matriculaLogin}&mes=${mes}&ano=${ano}`;
  const resp = await fetch(url);
  const dados = await resp.json();

  montarCalendario(dados);
}

/* CALENDÃRIO */
function montarCalendario(dados) {
  const calendario = document.getElementById("calendario");
  calendario.innerHTML = "";

  const mes = document.getElementById("mes").value;
  const ano = document.getElementById("ano").value;

  const primeiroDia = new Date(ano, mes - 1, 1);
  const ultimoDia = new Date(ano, mes, 0).getDate();
  const inicioSemana = primeiroDia.getDay();

  const mapa = {};
  dados.forEach(d => {
    if (!d.datauso) return;
    const dia = Number(d.datauso.split("-")[2]);
    mapa[dia] = d.sequencia || "Sem sequÃªncia";
  });

  for (let i = 0; i < inicioSemana; i++) {
    calendario.innerHTML += `<div class="dia vazio"></div>`;
  }

  for (let d = 1; d <= ultimoDia; d++) {
    if (mapa[d]) {
      calendario.innerHTML += `
        <div class="dia registrado">
          ${d}
          <span class="sequencia">${mapa[d]}</span>
        </div>`;
    } else {
      calendario.innerHTML += `<div class="dia">${d}</div>`;
    }
  }
}
</script>

</body>
</html>
